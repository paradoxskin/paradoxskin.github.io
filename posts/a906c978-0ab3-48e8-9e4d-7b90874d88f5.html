<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>JS é—­åŒ…</title>
    <link rel="stylesheet" href="/res/css/style.css">
</head>
<body>

<h2>é—­åŒ…</h2>
<blockquote>
<p>æˆ‘åœ¨å†™ä¿¡æ¯ç®¡ç†ç³»ç»Ÿçš„å‰ç«¯é¡µé¢ï¼Œå†³å®šä½¿ç”¨ jquery æ¥å®ç°å‰åç«¯åˆ†ç¦»ï¼Œå…·ä½“çš„æ–¹æ³•æ˜¯åœ¨å‰ç«¯ script é‡Œé¢ä½¿ç”¨ ajax æ¥å¼‚æ­¥å¸¦ç€æ•°æ®è®¿é—®åç«¯ï¼Œç„¶åæ ¹æ®åç«¯è¿”å›çš„ json æ¥æ¸²æŸ“å‰ç«¯çš„é¡µé¢ï¼Œè‡³äºæˆ‘ä¸ºä»€ä¹ˆä¼šé‡åˆ°é—­åŒ…è¿™ä¸ªä¸œè¥¿å‘¢ï¼Ÿå¬æˆ‘æ…¢æ…¢é“æ¥ ...</p>
<!--more-->
</blockquote>
<p>å½“æ—¶å†™çš„ä»£ç æ˜¯ä¼ ç»™åç«¯ tokenï¼Œç„¶ååç«¯æ ¹æ® token å¯¹åº”çš„ç”¨æˆ·çš„æƒé™è¿”å›è¦åŠ è½½çš„é€‰é¡¹å¡ï¼Œåç«¯åŠŸèƒ½å¾ˆå¥½å®ç°ï¼Œç›´æ¥è¿™ä¹ˆå†™å°±è¡Œäº†</p>
<pre><code class="language-go">token, isOk := c.GetPostForm(&quot;token&quot;)
if !isOk {
    c.JSON(200, map[string]interface{}{
        &quot;msg&quot;: &quot;fail&quot;,
    })
    return
}
if !service.CheckToken(&amp;token) {
    c.JSON(200, map[string]interface{}{
        &quot;msg&quot;: &quot;fail&quot;,
    })
    return
}
if service.CheckRoot(&amp;token) {
    c.JSON(200, map[string]interface{}{
        &quot;msg&quot;: &quot;ok&quot;,
        // TODO
    })
    return
}
infoBacks := []pojo.InfoBack{{
    ButtonId: &quot;info&quot;,
    ObjUrl: &quot;/info&quot;,
    ButtonName: &quot;ä¸ªäººä¿¡æ¯&quot;,
}, {
    ButtonId: &quot;room&quot;,
    ObjUrl: &quot;/room&quot;,
    ButtonName: &quot;å¯å®¤&quot;,
}, {
    ButtonId: &quot;clean&quot;,
    ObjUrl: &quot;/clean&quot;,
    ButtonName: &quot;å«ç”Ÿæ£€æŸ¥&quot;,
}, {
    ButtonId: &quot;break&quot;,
    ObjUrl: &quot;/break&quot;,
    ButtonName: &quot;æŠ¥ä¿®&quot;,
}, {
    ButtonId: &quot;lost&quot;,
    ObjUrl: &quot;/lost&quot;,
    ButtonName: &quot;å¤±ç‰©æ‹›é¢†&quot;,
},
                            }
c.JSON(200, map[string]interface{}{
    &quot;msg&quot;: &quot;ok&quot;,
    &quot;infos&quot;: infoBacks,
})
</code></pre>
<p>å®ç°æ¥å£ä¹‹åæˆ‘å°±æŠŠè§†çº¿è½¬åˆ°å‰ç«¯äº†ï¼Œå…ˆ F12 é‡Œçš„ console é‡Œæµ‹è¯•äº†ä¸‹ï¼Œå¯ä»¥æ¥æ”¶åˆ° json æ•°æ®ï¼Œç„¶åå°±å¼€å§‹å†™ js äº†ï¼Œå¤§è‡´æ€è·¯çš„æ ¹æ®ä¼ å›çš„æ•°æ®ï¼Œéå†æ‰€æœ‰å…ƒç´ ç„¶ååˆ›å»º li æ ‡ç­¾åŠ æŒ‰é’®ï¼Œæœ€åæŠŠåˆ›å»ºå‡ºæ¥çš„æŒ‰é’®ç»‘å®šä¸Š click äº‹ä»¶çš„å‡½æ•°</p>
<p>åˆç‰ˆä»£ç æ˜¯è¿™æ ·çš„</p>
<pre><code class="language-html">&lt;script charset=&quot;utf-8&quot;&gt;
    $(function() {
        $(&quot;#quit&quot;).click(function() {
            var token = localStorage.getItem(&quot;token&quot;);
            localStorage.removeItem(&quot;token&quot;);
            var tks={&quot;token&quot;:token}
            $.post(
                &quot;/quit&quot;,
                tks,
                function() {
                    location.assign(&quot;/login&quot;);
                }
            );
        });
        var token = localStorage.getItem(&quot;token&quot;);
        $.post(
            &quot;/index&quot;,
            {&quot;token&quot;: token},
            function(data) {
                var indexs = data
                for(var i = 0; i &lt; data.infos.length; i++) {
                    $(&quot;#menu&quot;).append(&quot;&lt;li class=\&quot;nav-item\&quot;&gt;&lt;button class=\&quot;my-2 btn btn-secondary btn-block w-100\&quot; type=\&quot;button\&quot; id=\&quot;&quot; + data.infos[i].button_id + &quot;\&quot;&gt;&quot; + data.infos[i].button_name + &quot;&lt;/button&gt;&lt;/li&gt;&quot;);
                    $(&quot;#&quot; + data.infos[i].button_id).click(function() {
                        $.get(
                            indexs.infos[i].obj_url,
                            function() {
                                console.log(&quot;6&quot;)
                            }
                        )
                    });
                }
                // TODO
            }
        );
    });
&lt;/script&gt;
</code></pre>
<p>æ—¢ç„¶æ˜¯åˆç‰ˆä»£ç ï¼Œé‚£å¿…ç„¶æ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿è¡Œç»“æœæ˜¯æ ‡ç­¾æ¸²æŸ“å‡ºæ¥äº†ï¼Œä½†æ˜¯æŒ‰é’®æŒ‰ä¸‹å»æ— äº‹å‘ç”Ÿï¼Œconsole é‡Œæ²¡æ˜¾ç¤º 6ï¼Œåç«¯çš„æ—¥å¿—ä¹Ÿæ²¡æœ‰æ˜¾ç¤º 404 çš„ get è¯·æ±‚ï¼ˆé‚£äº›ç«¯å£æˆ‘éƒ½æ²¡å†™å¥½</p>
<p>å¯å–œå¯è´ºçš„æ˜¯æˆ‘åœ¨ console é‡Œä»”ç»†çœ‹äº†ä¸‹å‘ç°äº†åœ¨æŒ‰ä¸‹æŒ‰é’®ä¹‹åä»–æŠ¥é”™äº†ï¼Œè¯´<code>indexs.infos[i] is undefined</code> ï¼Œç„¶åæˆ‘å¤§æ¦‚çŸ¥é“äº†æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œç»‘å®šå‡½æ•°çš„è¿‡ç¨‹ä¸åŒ…æ‹¬æ‰§è¡Œï¼Œæ‰€ä»¥å†æ¬¡è¿è¡Œçš„æ—¶å€™å®ƒæ˜¯ç‹¬ç«‹å‡ºæ¥è¿è¡Œçš„ï¼Œè¿™æ—¶å€™ i å°±ä¸è§äº†ï¼Œæ‰€ä»¥å°±æŠ¥é”™äº†</p>
<p>é‚£ä¹ˆæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå‡­æˆ‘çš„ç»éªŒè‚¯å®šä¸èƒ½è§£å†³è¿™ç§é—®é¢˜ï¼Œå€ŸåŠ©äº†å¼ºå¤§çš„æœç´¢å¼•æ“ï¼Œæˆ‘æ‰¾åˆ°äº†å’Œæˆ‘é‡åˆ°ç±»ä¼¼é—®é¢˜çš„äºº <a href="https://blog.csdn.net/qq_38712081/article/details/81665379">ğŸ”—</a></p>
<p>ä¸‹é¢æ˜¯èƒ½å¤Ÿ work çš„ä»£ç </p>
<pre><code class="language-html">&lt;script&gt;
function(data) {
    var indexs = data;
    for(var i = 0; i &lt; data.infos.length; i++) {
        $(&quot;#menu&quot;).append(&quot;&lt;li class=\&quot;nav-item\&quot;&gt;&lt;button class=\&quot;my-2 btn btn-secondary btn-block w-100\&quot; type=\&quot;button\&quot; id=\&quot;&quot; + data.infos[i].button_id + &quot;\&quot;&gt;&quot; + data.infos[i].button_name + &quot;&lt;/button&gt;&lt;/li&gt;&quot;);
        (function(i) {
        $(&quot;#&quot; + data.infos[i].button_id).click(function() {
            $.get(
                indexs.infos[i].obj_url,
                function() {
                    console.log(&quot;6&quot;)
                }
            )
        });})(i)
    }
}
&lt;/script&gt;
</code></pre>
<blockquote>
<p>ä¸€ä¸ªäººåŒæ—¶å†™å‰åç«¯çœŸçš„æŒºç´¯çš„ï¼Œä¸è¿‡æˆå°±æ„Ÿå€’æ˜¯æœ‰çš„ï¼Œweb ä¹Ÿå°±è¿™å›äº‹</p>
</blockquote>

<script src="/res/js/scripts.js" defer></script>
</body>
</html>